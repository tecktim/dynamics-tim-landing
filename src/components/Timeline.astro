---
import type { CollectionEntry } from 'astro:content';

interface Props {
  items: CollectionEntry<'timeline'>[];
}

const { items } = Astro.props as Props;
const rendered = await Promise.all(
  items.map(async (entry) => {
    const { Content } = await entry.render();
    return { entry, Content };
  })
);
---

<section class="bg-surface-100 py-20">
  <div class="mx-auto max-w-6xl px-6">
    <div class="mb-10 max-w-3xl space-y-4">
      <h2 class="section-title">Erfahrung im Überblick</h2>
      <p class="text-lg text-slate-600">
        Von Enterprise-Rollouts bis schnellen Prototypen: Hands-on Erfahrung entlang der gesamten Dynamics 365 Delivery-Kette.
      </p>
    </div>
    <ol class="relative border-l border-surface-200">
      {rendered.map(({ entry, Content }) => (
        <li class="relative ml-6 border-b border-surface-200 py-8 last:border-b-0" key={entry.id}>
          <div class="absolute -left-3 top-9 z-20 h-6 w-6 rounded-full border-4 border-white bg-accent-400 shadow-soft" aria-hidden="true"></div>
          <div class="card card--resume flex flex-col gap-2">
            <div class="flex flex-wrap items-center gap-3 text-sm font-semibold uppercase tracking-wide text-brand-600">
              <span>{entry.data.startDate} – {entry.data.endDate ?? 'Heute'}</span>
              {entry.data.location && <span class="text-slate-500">{entry.data.location}</span>}
            </div>
            <h3 class="text-2xl font-semibold text-slate-900">{entry.data.title}</h3>
            <p class="text-base font-medium text-slate-600">{entry.data.company}</p>
            <div class="prose text-slate-600">
              <Content />
            </div>
            {entry.data.tags.length > 0 && (
              <div class="mt-4 flex flex-wrap gap-2">
                {entry.data.tags.map((tag) => (
                  <span class="rounded-full bg-brand-50 px-3 py-1 text-xs font-semibold text-brand-600" key={tag}>
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </li>
      ))}
    </ol>
  </div>
</section>
